\chapter{Matrix Vector Multiplication}
\section{OpenMP Matrix Vector Multiplication}
\pgfplotstableread[format=file,col sep=comma]{../../../data/1-openmp/p2/false-sharing-variable-procs-1000x100000.processed}\falsesharingvarprocsA
\pgfplotstableread[format=file,col sep=comma]{../../../data/1-openmp/p2/tiling-variable-procs-1000x100000.processed}\tilingvarprocsA


\begin{figure}[h!]
  \centering
  \begin{tikzpicture}
    \begin{axis}[
	      width=0.8\linewidth,
	      xlabel={Threads},
	      ylabel={Time [s]},
	      %xmode=log, ymode=log,
	      enlarge x limits=false,
	      axis on top,
	      legend transposed =true,
	      legend style={
		      draw=none,
		      cells={anchor=west},
		      legend pos=outer north east,
	      },
	      reverse legend,
	      ymin=0,
	    ]
	    \addplot [stack plots=y, fill=none, draw=none, forget plot]		table [x=id, y=min]		{\tilingvarprocsA} \closedcycle;
	    \addplot [stack plots=y, fill=green, fill opacity=0.4, draw opacity=0, area legend]	table [x=id, y expr=\thisrow{med}-\thisrow{min}]	{\tilingvarprocsA} \closedcycle;
	    \addplot [stack plots=false, draw=black, thick]					table [x=id, y=med]		{\tilingvarprocsA};
	    \addplot [stack plots=y, fill=red!50, fill opacity=0.4, draw opacity=0, area legend]table [x=id, y expr=\thisrow{max}-\thisrow{med}]	{\tilingvarprocsA} \closedcycle;

	    \addlegendentry{{below med.}}
	    \addlegendentry{{med.}}
	    \addlegendentry{{above med.}}

	  \end{axis}
  \end{tikzpicture}
  \caption{Benchmark results showing \textbf{run time per number of threads} of the \textbf{Tiling Algorithm} in \textbf{Open-MP} for a \textbf{1000x100000 matrix}. Raw data can be found in the appendix: \autoref{res-tbl:3-tilingvarprocsA}}
  \label{plot:3-tilingvarprocsA}
\end{figure}


\begin{figure}[h!]
  \centering
  \begin{tikzpicture}
    \begin{axis}[
	      width=0.8\linewidth,
	      xlabel={Threads},
	      ylabel={Time [s]},
	      %xmode=log, ymode=log,
	      enlarge x limits=false,
	      axis on top,
	      legend transposed =true,
	      legend style={
		      draw=none,
		      cells={anchor=west},
		      legend pos=outer north east,
	      },
	      reverse legend,
	      ymin=0,
	    ]
	    \addplot [stack plots=y, fill=none, draw=none, forget plot]		table [x=id, y=min]		{\falsesharingvarprocsA} \closedcycle;
	    \addplot [stack plots=y, fill=green, fill opacity=0.4, draw opacity=0, area legend]	table [x=id, y expr=\thisrow{med}-\thisrow{min}]	{\falsesharingvarprocsA} \closedcycle;
	    \addplot [stack plots=false, draw=black, thick]					table [x=id, y=med]		{\falsesharingvarprocsA};
	    \addplot [stack plots=y, fill=red!50, fill opacity=0.4, draw opacity=0, area legend]table [x=id, y expr=\thisrow{max}-\thisrow{med}]	{\falsesharingvarprocsA} \closedcycle;

	    \addlegendentry{{below med.}}
	    \addlegendentry{{med.}}
	    \addlegendentry{{above med.}}

	  \end{axis}
  \end{tikzpicture}
  \caption{Benchmark results showing \textbf{run time per number of threads} of the \textbf{False Sharing Algorithm} in \textbf{Open-MP} for a \textbf{1000x100000 matrix}. Raw data can be found in the appendix: \autoref{res-tbl:3-tilingvarprocsA}}
  \label{plot:3-falsesharingvarprocsA}
\end{figure}



\begin{figure}[h!]
\centering
\begin{tikzpicture}
\begin{axis}[
	width=0.8\linewidth,
  xlabel={Threads},
	ylabel={Time [s]},
	%legend columns=4,
	%legend entries={data:,below median,median,above median,
					%task:,below median,median,above median},
	xmode=linear, ymode=linear,
	enlarge x limits=false,
	axis on top,
	legend transposed =true,
	legend style={
		draw=none,
		cells={anchor=west},
		legend pos=outer north east,
	},
	%reverse legend,
	ymin=0,
	]

	%\addplot [stack plots=y, fill=none, draw=none, forget plot]		table [x=id, y=min]		{\openmpprefixseqn} \closedcycle;
	%\addplot [stack plots=y, fill=olive!40!green!60, fill opacity=0.4, draw opacity=0, area legend]	table [x=id, y expr=\thisrow{med}-\thisrow{min}]	{\openmpprefixseqn} \closedcycle;
	\addplot [fill=none, draw=blue, thick]	table [x=id, y=min]		{\falsesharingvarprocsA};
	\addlegendentry{{False Sharing. minimum}}
	\addplot [draw=blue, loosely dotted, thick]	table [x=id, y=med]		{\falsesharingvarprocsA};
	\addlegendentry{{False Sharing. median}}
	\addplot [fill=none, draw=red, thick]	table [x=id, y=min]		{\tilingvarprocsA};
	\addlegendentry{{Tiling. minimum}}
	\addplot [draw=red, loosely dotted, thick]		table [x=id, y=med]		{\tilingvarprocsA};
	\addlegendentry{{Tiling. median}}
	%\resetstackedplots

	\end{axis}
\end{tikzpicture}
\caption{Benchmark results showing the different algorithms in \textbf{OpenMP}. Raw data can be found in the appendix: \autoref{res-tbl:1-1-seq-n} \autoref{res-tbl:1-1-auxarr-n} \autoref{res-tbl:1-1-inplace-n}}
\label{plot:1-1-n}
\end{figure}


%%% 100000x1000

\pgfplotstableread[format=file,col sep=comma]{../../../data/1-openmp/p2/false-sharing-variable-procs-100000x1000.processed}\falsesharingvarprocsB
\pgfplotstableread[format=file,col sep=comma]{../../../data/1-openmp/p2/tiling-variable-procs-100000x1000.processed}\tilingvarprocsB


\begin{figure}[h!]
  \centering
  \begin{tikzpicture}
    \begin{axis}[
	      width=0.8\linewidth,
	      xlabel={Threads},
	      ylabel={Time [s]},
	      %xmode=log, ymode=log,
	      enlarge x limits=false,
	      axis on top,
	      legend transposed =true,
	      legend style={
		      draw=none,
		      cells={anchor=west},
		      legend pos=outer north east,
	      },
	      reverse legend,
	      ymin=0,
	    ]
	    \addplot [stack plots=y, fill=none, draw=none, forget plot]		table [x=id, y=min]		{\tilingvarprocsB} \closedcycle;
	    \addplot [stack plots=y, fill=green, fill opacity=0.4, draw opacity=0, area legend]	table [x=id, y expr=\thisrow{med}-\thisrow{min}]	{\tilingvarprocsB} \closedcycle;
	    \addplot [stack plots=false, draw=black, thick]					table [x=id, y=med]		{\tilingvarprocsB};
	    \addplot [stack plots=y, fill=red!50, fill opacity=0.4, draw opacity=0, area legend]table [x=id, y expr=\thisrow{max}-\thisrow{med}]	{\tilingvarprocsB} \closedcycle;

	    \addlegendentry{{below med.}}
	    \addlegendentry{{med.}}
	    \addlegendentry{{above med.}}

	  \end{axis}
  \end{tikzpicture}
  \caption{Benchmark results showing \textbf{run time per number of threads} of the \textbf{Tiling Algorithm} in \textbf{Open-MP} for a \textbf{100000x1000 matrix}. Raw data can be found in the appendix: \autoref{res-tbl:3-tilingvarprocsB}}
  \label{plot:3-tilingvarprocsB}
\end{figure}


\begin{figure}[h!]
  \centering
  \begin{tikzpicture}
    \begin{axis}[
	      width=0.8\linewidth,
	      xlabel={Threads},
	      ylabel={Time [s]},
	      %xmode=log, ymode=log,
	      enlarge x limits=false,
	      axis on top,
	      legend transposed =true,
	      legend style={
		      draw=none,
		      cells={anchor=west},
		      legend pos=outer north east,
	      },
	      reverse legend,
	      ymin=0,
	    ]
	    \addplot [stack plots=y, fill=none, draw=none, forget plot]		table [x=id, y=min]		{\falsesharingvarprocsB} \closedcycle;
	    \addplot [stack plots=y, fill=green, fill opacity=0.4, draw opacity=0, area legend]	table [x=id, y expr=\thisrow{med}-\thisrow{min}]	{\falsesharingvarprocsB} \closedcycle;
	    \addplot [stack plots=false, draw=black, thick]					table [x=id, y=med]		{\falsesharingvarprocsB};
	    \addplot [stack plots=y, fill=red!50, fill opacity=0.4, draw opacity=0, area legend]table [x=id, y expr=\thisrow{max}-\thisrow{med}]	{\falsesharingvarprocsB} \closedcycle;

	    \addlegendentry{{below med.}}
	    \addlegendentry{{med.}}
	    \addlegendentry{{above med.}}

	  \end{axis}
  \end{tikzpicture}
  \caption{Benchmark results showing \textbf{run time per number of threads} of the \textbf{False Sharing Algorithm} in \textbf{Open-MP} for a \textbf{100000x1000 matrix}.  \autoref{res-tbl:3-tilingvarprocsB}}
  \label{plot:3-falsesharingvarprocsB}
\end{figure}



\begin{figure}[h!]
\centering
\begin{tikzpicture}
\begin{axis}[
	width=0.8\linewidth,
  xlabel={Threads},
	ylabel={Time [s]},
	%legend columns=4,
	%legend entries={data:,below median,median,above median,
					%task:,below median,median,above median},
	xmode=linear, ymode=linear,
	enlarge x limits=false,
	axis on top,
	legend transposed =true,
	legend style={
		draw=none,
		cells={anchor=west},
		legend pos=outer north east,
	},
	%reverse legend,
	ymin=0,
	]

	%\addplot [stack plots=y, fill=none, draw=none, forget plot]		table [x=id, y=min]		{\openmpprefixseqn} \closedcycle;
	%\addplot [stack plots=y, fill=olive!40!green!60, fill opacity=0.4, draw opacity=0, area legend]	table [x=id, y expr=\thisrow{med}-\thisrow{min}]	{\openmpprefixseqn} \closedcycle;
	\addplot [fill=none, draw=blue, thick]	table [x=id, y=min]		{\falsesharingvarprocsB};
	\addlegendentry{{False Sharing. minimum}}
	\addplot [draw=blue, loosely dotted, thick]	table [x=id, y=med]		{\falsesharingvarprocsB};
	\addlegendentry{{False Sharing. median}}
	\addplot [fill=none, draw=red, thick]	table [x=id, y=min]		{\tilingvarprocsB};
	\addlegendentry{{Tiling. minimum}}
	\addplot [draw=red, loosely dotted, thick]		table [x=id, y=med]		{\tilingvarprocsB};
	\addlegendentry{{Tiling. median}}
	%\resetstackedplots

	\end{axis}
\end{tikzpicture}
\caption{Benchmark results showing the different algorithms in \textbf{OpenMP}. \autoref{res-tbl:3-tilingvarprocsB} \autoref{res-tbl:3-falsesharingvarprocsB}}
\label{plot:1-1-n}
\end{figure}



%%%%%%%%%% VARIABLE N


\pgfplotstableread[format=file,col sep=comma]{../../../data/1-openmp/p2/tiling-fixed-m-100000.processed}\falsesharingFixedMA
\pgfplotstableread[format=file,col sep=comma]{../../../data/1-openmp/p2/false-sharing-fixed-m-100000.processed}\tilingFixedMA



\begin{figure}[h!]
\centering
\begin{tikzpicture}
\begin{axis}[
	width=0.8\linewidth,
  xlabel={N},
	ylabel={Time [s]},
	%legend columns=4,
	%legend entries={data:,below median,median,above median,
					%task:,below median,median,above median},
	xmode=linear, ymode=linear,
	enlarge x limits=false,
	axis on top,
	legend transposed =true,
	legend style={
		draw=none,
		cells={anchor=west},
		legend pos=outer north east,
	},
	%reverse legend,
	ymin=0,
	]

	\addplot [fill=none, draw=blue, thick]	table [x=id, y=min]		{\falsesharingFixedMA};
	\addlegendentry{{False Sharing. minimum}}
	\addplot [draw=blue, loosely dotted, thick]	table [x=id, y=med]		{\falsesharingFixedMA};
	\addlegendentry{{False Sharing. median}}
  \addplot [fill=none, draw=blue, dashed, thick]	table [x=id, y=max]		{\falsesharingFixedMA};
	\addlegendentry{{False Sharing. maximum}}

	\addplot [fill=none, draw=red, thick]	table [x=id, y=min]		{\tilingFixedMA};
	\addlegendentry{{Tiling. minimum}}
	\addplot [draw=red, loosely dotted, thick]		table [x=id, y=med]		{\tilingFixedMA};
	\addlegendentry{{Tiling. median}}
  \addplot [draw=red, dashed, thick]		table [x=id, y=max]		{\tilingFixedMA};
	\addlegendentry{{Tiling. maximum}}

	%\resetstackedplots

	\end{axis}
\end{tikzpicture}
\caption{Benchmark results showing the different algorithms in \textbf{OpenMP} for a \textbf{fixed M } and a \textbf{variable N ( 10 100 500 1000 5000 10000 50000 100000 )}.  \autoref{res-tbl:3-tilingFixedMA} \autoref{res-tbl:3-falsesharingFixedMA}}
\label{plot:1-1-n}
\end{figure}


%%%%%%%%%% VARIABLE M



\pgfplotstableread[format=file,col sep=comma]{../../../data/1-openmp/p2/tiling-fixed-n-100000.processed}\falsesharingFixedNA
\pgfplotstableread[format=file,col sep=comma]{../../../data/1-openmp/p2/false-sharing-fixed-n-100000.processed}\tilingFixedNA



\begin{figure}[h!]
\centering
\begin{tikzpicture}
\begin{axis}[
	width=0.8\linewidth,
  xlabel={M},
	ylabel={Time [s]},
	%legend columns=4,
	%legend entries={data:,below median,median,above median,
					%task:,below median,median,above median},
	xmode=linear, ymode=linear,
	enlarge x limits=false,
	axis on top,
	legend transposed =true,
	legend style={
		draw=none,
		cells={anchor=west},
		legend pos=outer north east,
	},
	%reverse legend,
	ymin=0,
	]

	\addplot [fill=none, draw=blue, thick]	table [x=id, y=min]		{\falsesharingFixedNA};
	\addlegendentry{{False Sharing. minimum}}
	\addplot [draw=blue, loosely dotted, thick]	table [x=id, y=med]		{\falsesharingFixedNA};
	\addlegendentry{{False Sharing. median}}
  \addplot [fill=none, draw=blue, dashed, thick]	table [x=id, y=max]		{\falsesharingFixedNA};
	\addlegendentry{{False Sharing. maximum}}

	\addplot [fill=none, draw=red, thick]	table [x=id, y=min]		{\tilingFixedNA};
	\addlegendentry{{Tiling. minimum}}
	\addplot [draw=red, loosely dotted, thick]		table [x=id, y=med]		{\tilingFixedNA};
	\addlegendentry{{Tiling. median}}
  \addplot [draw=red, dashed, thick]		table [x=id, y=max]		{\tilingFixedNA};
	\addlegendentry{{Tiling. maximum}}

	%\resetstackedplots

	\end{axis}
\end{tikzpicture}
\caption{Benchmark results showing the different algorithms in \textbf{OpenMP} for a \textbf{fixed N } and a \textbf{variable M ( 10 100 500 1000 5000 10000 50000 100000 )}.  \autoref{res-tbl:3-tilingFixedNA} \autoref{res-tbl:3-falsesharingFixedNA}}
\label{plot:1-1-n}
\end{figure}



\section{NEC MPI Matrix Vector Multiplication}




%%% Fixed PROCS

\pgfplotstableread[format=file,col sep=comma]{../../../data/3-mpi/p3/allgather-fixed-procs-10.processed}\AllgatherFixedProcs
\pgfplotstableread[format=file,col sep=comma]{../../../data/3-mpi/p3/reduce-scatter-fixed-procs-10.processed}\ReduceScatterFixedProcs



\begin{figure}[h!]
\centering
\begin{tikzpicture}
\begin{axis}[
	width=0.8\linewidth,
  xlabel={N},
	ylabel={Time [s]},
	%legend columns=4,
	%legend entries={data:,below median,median,above median,
					%task:,below median,median,above median},
	xmode=linear, ymode=log,
	enlarge x limits=false,
	axis on top,
	legend transposed =true,
	legend style={
		draw=none,
		cells={anchor=west},
		legend pos=outer north east,
	},
	%reverse legend,
	ymin=0,
	]

	\addplot [fill=none, draw=blue, thick]	table [x=id, y=min]		{\AllgatherFixedProcs};
	\addlegendentry{{MPI\_Allgather min}}
	\addplot [draw=blue, loosely dotted, thick]	table [x=id, y=med]		{\AllgatherFixedProcs};
	\addlegendentry{{MPI\_Allgather med}}
  \addplot [fill=none, draw=blue, dashed, thick]	table [x=id, y=max]		{\AllgatherFixedProcs};
	\addlegendentry{{MPI\_Allgather max}}

	\addplot [fill=none, draw=red, thick]	table [x=id, y=min]		{\ReduceScatterFixedProcs};
	\addlegendentry{{MPI\_ReduceScatter min}}
	\addplot [draw=red, loosely dotted, thick]		table [x=id, y=med]		{\ReduceScatterFixedProcs};
	\addlegendentry{{MPI\_ReduceScatter med}}
  \addplot [draw=red, dashed, thick]		table [x=id, y=max]		{\ReduceScatterFixedProcs};
	\addlegendentry{{MPI\_ReduceScatter max}}

	%\resetstackedplots

	\end{axis}
\end{tikzpicture}
\caption{Benchmark results showing the \textbf{MPI\_Allgather and MPI\_ReduceScatter} implementations with \textbf{NEC-MPI} for a \textbf{fixed proc size of 10 } and a \textbf{variable N ( 100 500 1000 5000 10000 )}.  \autoref{res-tbl:3-allgatherFixedProc} \autoref{res-tbl:3-reduceScatterFixedProc}}
\label{plot:1-1-n}
\end{figure}


%%% VARIABLE PROCS 1..10

\pgfplotstableread[format=file,col sep=comma]{../../../data/3-mpi/p3/allgather-variable-procs-10000.processed}\AllgatherVariableProcs
\pgfplotstableread[format=file,col sep=comma]{../../../data/3-mpi/p3/reduce-scatter-variable-procs-10000.processed}\ReduceScatterVariableProcs



\begin{figure}[h!]
\centering
\begin{tikzpicture}
\begin{axis}[
	width=0.8\linewidth,
  xlabel={Procs},
	ylabel={Time [s]},
	%legend columns=4,
	%legend entries={data:,below median,median,above median,
					%task:,below median,median,above median},
	xmode=linear, ymode=log,
	enlarge x limits=false,
	axis on top,
	legend transposed =true,
	legend style={
		draw=none,
		cells={anchor=west},
		legend pos=outer north east,
	},
	%reverse legend,
	ymin=0,
	]

	\addplot [fill=none, draw=blue, thick]	table [x=id, y=min]		{\AllgatherVariableProcs};
	\addlegendentry{{MPI\_Allgather min}}
	\addplot [draw=blue, loosely dotted, thick]	table [x=id, y=med]		{\AllgatherVariableProcs};
	\addlegendentry{{MPI\_Allgather med}}
  \addplot [fill=none, draw=blue, dashed, thick]	table [x=id, y=max]		{\AllgatherVariableProcs};
	\addlegendentry{{MPI\_Allgather max}}

	\addplot [fill=none, draw=red, thick]	table [x=id, y=min]		{\ReduceScatterVariableProcs};
	\addlegendentry{{MPI\_ReduceScatter min}}
	\addplot [draw=red, loosely dotted, thick]		table [x=id, y=med]		{\ReduceScatterVariableProcs};
	\addlegendentry{{MPI\_ReduceScatter med}}
  \addplot [draw=red, dashed, thick]		table [x=id, y=max]		{\ReduceScatterVariableProcs};
	\addlegendentry{{MPI\_ReduceScatter max}}

	%\resetstackedplots

	\end{axis}
\end{tikzpicture}
\caption{Benchmark results showing the \textbf{MPI\_Allgather and MPI\_ReduceScatter} implementations with \textbf{NEC-MPI} for a \textbf{fixed size N of 10000 } and \textbf{( variable procs 1..10 )}.  \autoref{res-tbl:3-allgatherVariableProc} \autoref{res-tbl:3-reduceScatterVariableProc}}
\label{plot:1-1-n}
\end{figure}
